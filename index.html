<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­å›¾å¯¼èˆª Â· æ™ºèƒ½è·¯å¾„å¤„ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(145deg, #f4f9ff 0%, #e6f0fa 100%);
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 3.2rem;
            box-shadow: 0 35px 65px -20px #1c3f60b3, inset 0 1px 4px white;
            width: 100%;
            max-width: 1100px;
            padding: 2.8rem 3rem;
            border: 1px solid rgba(255, 255, 255, 0.9);
        }

        h1 {
            font-size: 2.7rem;
            font-weight: 620;
            letter-spacing: -0.02em;
            color: #0a2b44;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
            border-bottom: 3px solid #a0c4e8;
            padding-bottom: 0.8rem;
        }

        .source-info {
            font-size: 1rem;
            color: #1f4370e6;
            margin: 1rem 0 2rem 0;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            flex-wrap: wrap;
            background: #deecfccc;
            padding: 0.7rem 2rem;
            border-radius: 60px;
            width: fit-content;
            border: 1px solid white;
        }

        .source-info code {
            background: #173e5f;
            color: white;
            padding: 0.3rem 1.2rem;
            border-radius: 40px;
            font-size: 0.95rem;
            font-weight: 520;
        }

        .debug-info {
            background: #2d4b6e;
            color: #eef5ff;
            padding: 0.5rem 1.5rem;
            border-radius: 30px;
            font-family: monospace;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.8rem 0 1.4rem 0;
        }

        .stats-bar h2 {
            font-weight: 550;
            font-size: 1.8rem;
            color: #103551;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .badge {
            background: #236197;
            color: white;
            border-radius: 40px;
            padding: 0.3rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: inset 0 1px 4px #bbdbff;
        }

        .table-wrapper {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 36px;
            background: #eaf1fab3;
            padding: 0.3rem;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: inset 0 2px 6px #0000000c;
        }

        .markdown-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.05rem;
            border-radius: 36px;
            overflow: hidden;
        }

        .markdown-table thead tr {
            background: #1e3b5a;
            color: white;
            font-weight: 530;
            text-align: left;
        }

        .markdown-table th {
            padding: 1.2rem 1.8rem;
            font-size: 1.1rem;
            letter-spacing: 0.3px;
        }

        .markdown-table th:first-child {
            border-top-left-radius: 30px;
        }
        .markdown-table th:last-child {
            border-top-right-radius: 30px;
        }

        .markdown-table tbody tr {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(4px);
            border-bottom: 1px solid #c9dff5;
            transition: background 0.15s;
        }

        .markdown-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.95);
        }

        .markdown-table td {
            padding: 1.2rem 1.8rem;
            color: #102d44;
            border-bottom: 1px solid #c9dff5;
        }

        .markdown-table td:first-child {
            font-weight: 500;
        }

        .markdown-table td a {
            color: #1d5191;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background: #e3f0ff;
            padding: 0.3rem 1.2rem 0.3rem 1rem;
            border-radius: 40px;
            border: 1px solid white;
            transition: all 0.15s;
            word-break: break-word;
        }

        .markdown-table td a:hover {
            background: #cbe3ff;
            border-color: #8eb9e6;
            transform: translateY(-1px);
            box-shadow: 0 6px 12px -8px #1b3d60;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: #f0f8ffed;
            border-radius: 3rem;
            border: 2px dashed #8fb1d1;
            color: #1f4d78;
            font-size: 1.2rem;
        }

        .error-tip {
            background: #feeceb;
            border-left: 6px solid #c25a4a;
            padding: 1.5rem 2.5rem;
            border-radius: 40px;
            margin: 1rem 0;
            color: #4f221e;
            font-weight: 450;
            word-break: break-word;
        }

        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #a0bcdb;
            border-top-color: #103450;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .footer-bar {
            margin-top: 2.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid #c2d8f1;
            padding-top: 1.5rem;
        }

        .file-location {
            background: #e5effb;
            padding: 0.5rem 1.8rem;
            border-radius: 40px;
            color: #113853;
            font-size: 0.98rem;
            font-weight: 480;
            border: 1px solid white;
            font-family: monospace;
        }

        .refresh-btn {
            background: transparent;
            border: 2px solid #a2c2e5;
            padding: 0.5rem 2.2rem;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 560;
            color: #1b4f7a;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .refresh-btn:hover {
            background: #e3efff;
            border-color: #3f7eb0;
            transform: scale(0.98);
        }

        .markdown-icon {
            font-size: 1.2rem;
            margin-right: 0.2rem;
        }

        .path-test {
            background: #f0f0f0;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #444;
        }
    </style>
</head>
<body>
<div class="glass-panel">
    <h1>
        <span>ğŸ“‹</span> çƒ­å›¾æ¸…å• Â· æ™ºèƒ½è·¯å¾„
        <span style="font-size: 1.2rem; margin-left: auto; background: #bed6f2; padding: 0.3rem 1.5rem; border-radius: 60px; font-weight: 430;">list.md</span>
    </h1>

    <!-- æ˜¾ç¤ºå½“å‰è·¯å¾„ä¿¡æ¯ -->
    <div class="source-info">
        <span>ğŸ“‚ å½“å‰é¡µé¢ URL:</span>
        <code id="currentUrlDisplay">è®¡ç®—ä¸­...</code>
        <span>â¬‡ï¸ å°è¯•åŠ è½½</span>
        <code id="listPathDisplay">./heat_maps/list.md</code>
    </div>

    <!-- è®¡æ•° + æ ‡é¢˜ -->
    <div class="stats-bar">
        <h2>
            <span>ğŸ”—</span> æ˜ å°„æ¡ç›®
        </h2>
        <div class="badge" id="countDisplay">â€”â€”</div>
    </div>

    <!-- è¡¨æ ¼å®¹å™¨ (åŠ¨æ€æ¸²æŸ“) -->
    <div id="tableContainer" class="table-wrapper">
        <!-- åŠ è½½å ä½ -->
        <div class="empty-state" id="loadingPlaceholder">
            <div style="display: flex; gap: 0.8rem; align-items: center; justify-content: center;">
                <span class="loading-spinner"></span>
                æ­£åœ¨å°è¯•åŠ è½½ <code>heat_maps/list.md</code> ...
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ï¼šåˆ·æ–° + è·¯å¾„æç¤º -->
    <div class="footer-bar">
        <span class="file-location" id="fullPathDisplay">è®¡ç®—è·¯å¾„ä¸­...</span>
        <button class="refresh-btn" id="refreshBtn">
            <span>â†»</span> é‡æ–°åŠ è½½
        </button>
    </div>
</div>

<script>
    (function() {
        // DOM å…ƒç´ 
        const tableContainer = document.getElementById('tableContainer');
        const countDisplay = document.getElementById('countDisplay');
        const refreshBtn = document.getElementById('refreshBtn');
        const currentUrlDisplay = document.getElementById('currentUrlDisplay');
        const listPathDisplay = document.getElementById('listPathDisplay');
        const fullPathDisplay = document.getElementById('fullPathDisplay');

        // è·å–å½“å‰é¡µé¢çš„URLè·¯å¾„ä¿¡æ¯
        function getBasePath() {
            // è·å–å½“å‰é¡µé¢çš„å®Œæ•´URL
            const currentUrl = window.location.href;
            // è·å–å½“å‰é¡µé¢çš„è·¯å¾„éƒ¨åˆ†ï¼ˆä¸åŒ…æ‹¬åŸŸåï¼‰
            const pathname = window.location.pathname;
            
            // æ˜¾ç¤ºå½“å‰URL
            currentUrlDisplay.textContent = currentUrl;
            
            // è®¡ç®—index.htmlæ‰€åœ¨çš„ç›®å½•
            let baseDir = '';
            if (pathname.includes('/')) {
                // å»æ‰æ–‡ä»¶åï¼Œåªä¿ç•™ç›®å½•è·¯å¾„
                const lastSlashIndex = pathname.lastIndexOf('/');
                if (lastSlashIndex > 0) {
                    baseDir = pathname.substring(0, lastSlashIndex + 1);
                } else {
                    baseDir = '/';
                }
            }
            
            return {
                fullUrl: currentUrl,
                pathname: pathname,
                baseDir: baseDir,
                origin: window.location.origin
            };
        }

        // æ„å»ºå®Œæ•´çš„list.mdè·¯å¾„ï¼ˆå°è¯•å¤šç§å¯èƒ½æ€§ï¼‰
        function getListMdPaths() {
            const pathInfo = getBasePath();
            const paths = [];
            
            // æ–¹æ³•1: åŸºäºå½“å‰ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆæœ€å¸¸ç”¨ï¼‰
            paths.push({
                url: './heat_maps/list.md',
                description: 'ç›¸å¯¹è·¯å¾„ (./heat_maps/list.md)'
            });
            
            // æ–¹æ³•2: åŸºäºbaseDirçš„ç»å¯¹è·¯å¾„
            if (pathInfo.baseDir) {
                const absolutePath = pathInfo.baseDir + 'heat_maps/list.md';
                paths.push({
                    url: absolutePath,
                    description: 'åŸºäºå½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„'
                });
            }
            
            // æ–¹æ³•3: æ ¹ç›®å½•ç›¸å¯¹è·¯å¾„
            paths.push({
                url: '/heat_maps/list.md',
                description: 'ç½‘ç«™æ ¹ç›®å½•ç›¸å¯¹è·¯å¾„'
            });
            
            // æ–¹æ³•4: å°è¯•å»æ‰å¯èƒ½çš„å¤šçº§ç›®å½•
            if (pathInfo.pathname.split('/').length > 2) {
                paths.push({
                    url: '../heat_maps/list.md',
                    description: 'ä¸Šçº§ç›®å½•ç›¸å¯¹è·¯å¾„'
                });
            }
            
            return paths;
        }

        // å°è¯•å¤šä¸ªè·¯å¾„åŠ è½½list.md
        async function tryLoadListMd() {
            const paths = getListMdPaths();
            
            // æ˜¾ç¤ºå°è¯•çš„è·¯å¾„
            listPathDisplay.innerHTML = paths.map(p => `<span class="path-test">${p.description}</span>`).join(' ');
            
            // ä¾æ¬¡å°è¯•æ¯ä¸ªè·¯å¾„
            for (let i = 0; i < paths.length; i++) {
                const path = paths[i];
                const urlWithCache = path.url + '?t=' + Date.now();
                
                try {
                    console.log(`å°è¯•åŠ è½½: ${path.url} (${path.description})`);
                    
                    const response = await fetch(urlWithCache, { 
                        cache: 'no-store', 
                        credentials: 'same-origin',
                        method: 'GET'
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        if (text && text.trim()) {
                            // æˆåŠŸåŠ è½½ï¼Œæ˜¾ç¤ºä½¿ç”¨çš„è·¯å¾„
                            fullPathDisplay.textContent = `âœ… æˆåŠŸåŠ è½½: ${path.url}`;
                            return { success: true, content: text, usedPath: path.url };
                        }
                    }
                } catch (e) {
                    console.log(`è·¯å¾„ ${path.url} åŠ è½½å¤±è´¥:`, e.message);
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªè·¯å¾„
                }
            }
            
            // æ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥
            fullPathDisplay.textContent = 'âŒ æ‰€æœ‰è·¯å¾„å°è¯•å‡å¤±è´¥';
            return { success: false, content: null, usedPath: null };
        }

        /**
         * è§£æ Markdown è¡¨æ ¼
         */
        function parseMarkdownTable(markdownText) {
            const lines = markdownText.split(/\r?\n/);
            const rows = [];
            let headerParsed = false;
            let nameColIndex = -1, pathColIndex = -1;

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line.startsWith('|') || !line.endsWith('|')) {
                    continue;
                }

                const cleaned = line.slice(1, -1).trim();
                const cells = cleaned.split('|').map(cell => cell.trim());

                if (cells.length === 0) continue;

                // è·³è¿‡åˆ†éš”è¡Œ
                if (cells.some(cell => cell.includes('---') || cell.includes('--:'))) {
                    continue;
                }

                // è§£æè¡¨å¤´
                if (!headerParsed) {
                    for (let j = 0; j < cells.length; j++) {
                        const lower = cells[j].toLowerCase();
                        if (lower.includes('æ˜¾ç¤ºåç§°') || lower.includes('display') || lower.includes('åç§°')) {
                            nameColIndex = j;
                        } else if (lower.includes('æ–‡ä»¶è·¯å¾„') || lower.includes('file') || lower.includes('path') || lower.includes('è·¯å¾„')) {
                            pathColIndex = j;
                        }
                    }
                    if (nameColIndex === -1 && cells.length >= 2) {
                        nameColIndex = 0;
                        pathColIndex = 1;
                    }
                    headerParsed = true;
                    continue;
                }

                // æå–æ•°æ®è¡Œ
                if (nameColIndex !== -1 && pathColIndex !== -1 && cells.length > Math.max(nameColIndex, pathColIndex)) {
                    let display = cells[nameColIndex].trim();
                    let filepath = cells[pathColIndex].trim();

                    display = display.replace(/\*\*/g, '').replace(/__/g, '');
                    filepath = filepath.replace(/\*\*/g, '').replace(/__/g, '');

                    if (filepath.startsWith('`') && filepath.endsWith('`')) {
                        filepath = filepath.slice(1, -1);
                    }

                    if (display && filepath) {
                        rows.push({ display, filepath });
                    }
                }
            }

            return rows;
        }

        // æ„å»ºå®Œæ•´çš„æ–‡ä»¶URL
        function buildFileUrl(filepath) {
            // å¦‚æœå·²ç»æ˜¯å®Œæ•´çš„HTTP URLï¼Œç›´æ¥ä½¿ç”¨
            if (filepath.startsWith('http://') || filepath.startsWith('https://')) {
                return filepath;
            }
            
            // ç§»é™¤å¼€å¤´çš„ ./ æˆ– /
            let cleanPath = filepath.replace(/^\.?\//, '');
            
            // è·å–å½“å‰é¡µé¢çš„åŸºç¡€è·¯å¾„
            const pathInfo = getBasePath();
            const baseDir = pathInfo.baseDir;
            
            // æ„å»ºå®Œæ•´URL
            if (cleanPath.startsWith('heat_maps/')) {
                return baseDir + cleanPath;
            } else if (cleanPath.includes('heat_maps/')) {
                return baseDir + cleanPath;
            } else {
                return baseDir + 'heat_maps/' + cleanPath;
            }
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(entries) {
            if (!entries || entries.length === 0) {
                tableContainer.innerHTML = `
                    <div class="empty-state">
                        <span style="font-size: 3rem; display: block; margin-bottom: 0.5rem;">ğŸ“­</span>
                        æ²¡æœ‰ä» <code>list.md</code> ä¸­è§£æåˆ°ä»»ä½•æœ‰æ•ˆæ¡ç›®
                    </div>
                `;
                countDisplay.textContent = '0 é¡¹';
                return;
            }

            let tableHtml = `
                <table class="markdown-table">
                    <thead>
                        <tr>
                            <th>æ˜¾ç¤ºåç§°</th>
                            <th>æ–‡ä»¶è·¯å¾„ (è¶…é“¾æ¥)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            entries.forEach(entry => {
                const displayEscaped = entry.display.replace(/[&<>"]/g, function(m) {
                    if (m === '&') return '&amp;';
                    if (m === '<') return '&lt;';
                    if (m === '>') return '&gt;';
                    if (m === '"') return '&quot;';
                    return m;
                });
                
                const filepathEscaped = entry.filepath.replace(/[&<>"]/g, function(m) {
                    if (m === '&') return '&amp;';
                    if (m === '<') return '&lt;';
                    if (m === '>') return '&gt;';
                    if (m === '"') return '&quot;';
                    return m;
                });
                
                const href = buildFileUrl(entry.filepath);
                const hrefAttr = href.replace(/[&<>"]/g, function(m) {
                    if (m === '&') return '&amp;';
                    if (m === '"') return '&quot;';
                    return m;
                });

                tableHtml += `
                    <tr>
                        <td>${displayEscaped}</td>
                        <td><a href="${hrefAttr}" target="_blank" rel="noopener noreferrer">ğŸ“ ${filepathEscaped}</a></td>
                    </tr>
                `;
            });

            tableHtml += `</tbody></table>`;
            tableContainer.innerHTML = tableHtml;
            countDisplay.textContent = `${entries.length} é¡¹`;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            tableContainer.innerHTML = `
                <div class="error-tip">
                    <strong>âš ï¸ åŠ è½½å¤±è´¥</strong><br>
                    ${message.replace(/[&<>]/g, function(m) {
                        if (m === '&') return '&amp;';
                        if (m === '<') return '&lt;';
                        if (m === '>') return '&gt;';
                        return m;
                    })}<br>
                    <span style="font-size:0.95rem;">è¯·ç¡®è®¤ <code>heat_maps/list.md</code> æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»ã€‚</span>
                </div>
            `;
            countDisplay.textContent = 'é”™è¯¯';
        }

        // æ˜¾ç¤ºåŠ è½½ä¸­
        function showLoading() {
            tableContainer.innerHTML = `
                <div class="empty-state">
                    <div style="display: flex; gap: 0.8rem; align-items: center; justify-content: center;">
                        <span class="loading-spinner"></span>
                        å°è¯•å¤šä¸ªè·¯å¾„åŠ è½½ <code>list.md</code> ...
                    </div>
                </div>
            `;
        }

        // ä¸»åŠ è½½å‡½æ•°
        async function loadMarkdownAndRender() {
            showLoading();
            
            const result = await tryLoadListMd();
            
            if (result.success && result.content) {
                const entries = parseMarkdownTable(result.content);
                renderTable(entries);
            } else {
                const pathInfo = getBasePath();
                showError(`æ— æ³•åŠ è½½ list.md æ–‡ä»¶ã€‚å·²å°è¯•å¤šä¸ªè·¯å¾„ã€‚<br>å½“å‰é¡µé¢è·¯å¾„: ${pathInfo.pathname}<br>è¯·ç¡®ä¿æ–‡ä»¶å­˜åœ¨äºæ­£ç¡®çš„ç›®å½•ã€‚`);
            }
        }

        // åˆå§‹åŒ–
        loadMarkdownAndRender();

        // åˆ·æ–°æŒ‰é’®
        refreshBtn.addEventListener('click', function(e) {
            e.preventDefault();
            loadMarkdownAndRender();
        });
    })();
</script>

<noscript>
    <div style="background:#f3dddd; padding:2rem; border-radius:2rem; text-align:center; margin:2rem 0;">
        âš ï¸ æ‚¨çš„æµè§ˆå™¨æœªå¯ç”¨ JavaScriptï¼Œæ— æ³•åŠ è½½åŠ¨æ€å†…å®¹ã€‚<br>
        è¯·ç›´æ¥æŸ¥çœ‹ <code>./heat_maps/list.md</code> æ–‡ä»¶ã€‚
    </div>
</noscript>
</body>
</html>